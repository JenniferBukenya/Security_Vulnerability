<?php

session_start();

// Check if the CSRF token is provided in the POST request
if(isset($_POST['csrf_token'])) {
    // Retrieve the CSRF token sent in the request
    $csrf_token = $_POST['csrf_token'];

    // Verify if the CSRF token matches the one stored in the session
    if($csrf_token === $_SESSION['csrf_token']) {
        // CSRF token is valid, proceed with deleting data

        // Require the database connection file
        require_once 'db_connect.php';

        // Attempt to delete data from the database
        try {
            // Prepare the SQL statement
            $stmt = $pdo->prepare("DELETE FROM students");

            // Execute the query
            $stmt->execute();

            // Redirect the user after successful deletion
            header("location:index.html");
            exit(); // Exit to prevent further execution
        } catch (PDOException $e) {
            // Handle database errors
            echo "Database Error: " . $e->getMessage();
        }
    } else {
        // CSRF token doesn't match, potential CSRF attack
        echo "CSRF token verification failed. This may be a CSRF attack.";
    }
} else {
    // CSRF token is not provided in the request
    echo "CSRF token is missing in the request.";
}

?>
