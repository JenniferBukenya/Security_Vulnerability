<?php
// Check if the request method is POST
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    // Simulate updating student performance and HIV status
    $id = $_POST['id'];
    $performance = $_POST['performance'];
    $hiv_status = $_POST['hiv_status'];
    $fullname = $_POST['fullname'];


    // In a real scenario, perform validation and sanitization of input data

    // Update student information (this is just a demonstration, in real application this should be properly handled)
    echo "Student with ID: $id updated successfully. Performance: $performance, HIV Status: $hiv_status";
    exit; // Terminate script execution
}
?>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Font Awesome -->
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

    <link rel="stylesheet" href="../css/login-page.css">
    <link rel="stylesheet" href="../css/demo.css" />

    <link rel="stylesheet" href="../menu.css">
    <link rel="stylesheet" type="../text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Raleway:100,200,400,500,600" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="../cards.css">

    <title>School|EditStudents</title>
</head>

<body>

    <h1>CSRF Attack Demo</h1>
    <p>This page simulates a CSRF attack by allowing an attacker to modify student performance and HIV status.</p>

    <section>
        <div class="rt-container">
            <div class="col-rt-12">
                <div class="Scriptcontent">
                    <form class="codehim-form" method="post" action="csrf.php">
                        <div class="form-title">
                            <h2> Edit Student Details</h2>
                        </div>
                        <!-- Hidden fields containing attacker-controlled data -->
                        <input type="hidden" name="id" value="<?php echo $_GET['id']; ?>">
                        
                        <!-- Attacker-controlled values -->
                        <label for="fullname"><i class="fa fa-user"></i>fullname:</label>
                        <input type="text" id="trid" class="cm-input" placeholder="fullname" value="fullname" readonly>

                        <label for="performance"><i class="fa fa-file-text"></i>performance:</label>
                        <input type="text" id="trid" class="cm-input" placeholder="performance" name="performance">

                        <label for="status"><i class="fa fa-medkit"></i>HIV Status:</label>
                        <input type="text" id="trid" class="cm-input" placeholder="HIV status" name="hivstatus">

                        <button type="submit" class="btn-login  gr-bg">Register</button>

                    </form>

                    // <?php

                        // // Require the database connection file
                        // require_once 'db_connect.php';

                        // $conn = mysqli_connect("localhost", "root", "", "school");
                        // if ($conn->connect_error) {
                        //     die("connection faied:" . $conn->connect_error);
                        // }

                        // $sql = "select * from students";

                        // $result = $conn->query($sql);

                        // if ($result->num_rows > 0) {

                        // while loop to fetch contents of the database
                        // echo '<form class="codehim-form" method="post" action="edit.php"><div class="form-title"><h2> Edit Performance</h2></div>';

                        // echo '<label for="fullname"><i class="fa fa-user"></i>fullname:</label>';
                        // echo '<input type="text" id="trid" class="cm-input" name="fullname" value="' . $fullname . '" readonly>';

                        // echo ' <label for="performance"><i class="fa fa-file-text"></i>performance:</label>';
                        // echo '<input type="text" id="trid" class="cm-input" name="performance" value="' . $performance . '">';

                        // echo ' <label for="status"><i class="fa fa-file-text"></i>HIV Status:</label>';
                        // echo '<input type="text" id="trid" class="cm-input" name="performance" value="' . $HIV_status . '">';


                        // echo '<tr><th>id</th><th>fullnames</th><th>performance</th><th>HIV Status</th><th>Action</th></tr>';

                        // while ($row = $result->fetch_assoc()) {


                        //     $id = $row['id'];
                        //     $fullname = $row['fullname'];
                        //     $performance = $row['performance'];
                        //     $HIV_status = $row['HIV_status'];


                        //     echo '<form method="post" action="">';
                        //     echo "<tr>";
                        //     echo '<td> ' . $id . ' </td>';
                        //     echo '<td> ' . $fullname . ' </td>';
                        //     echo '<td> ' . $performance . ' </td>';
                        //     echo '<td> ' . $HIV_status . ' </td>';
                        //     echo '<td><a href="edit.php?id=' . $id . '&fullname=' . $fullname . '&performance=' . $performance . '">Edit</a></td>';

                        //     echo "</tr></form>";
                        //     echo '</div>';
                        // }
                        // echo "</table";
                        // echo '</div>';
                        // // } else {
                        // // }

                        // 
                        ?>
                </div>